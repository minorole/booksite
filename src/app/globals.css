@import 'tailwindcss';
@plugin "tailwindcss-animate";

@layer base {
  :root {
    --background: 0 0% 100%;
    --foreground: 222.2 84% 4.9%;
    --card: 0 0% 100%;
    --card-foreground: 222.2 84% 4.9%;
    --popover: 0 0% 100%;
    --popover-foreground: 222.2 84% 4.9%;
    --primary: 222.2 47.4% 11.2%;
    --primary-foreground: 210 40% 98%;
    --secondary: 210 40% 96.1%;
    --secondary-foreground: 222.2 47.4% 11.2%;
    --muted: 210 40% 96.1%;
    --muted-foreground: 215.4 16.3% 46.9%;
    --accent: 210 40% 96.1%;
    --accent-foreground: 222.2 47.4% 11.2%;
    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 210 40% 98%;
    --border: 214.3 31.8% 91.4%;
    --input: 214.3 31.8% 91.4%;
    --ring: 222.2 84% 4.9%;
    --chart-1: 12 76% 61%;
    --chart-2: 173 58% 39%;
    --chart-3: 197 37% 24%;
    --chart-4: 43 74% 66%;
    --chart-5: 27 87% 67%;
    --radius: 0.5rem;
    /* Font variables (Archivo via next/font, MaShanZheng via manual @font-face) */
    --font-archivo: 'Archivo';
    --font-mashanzheng: 'MaShanZhengZh';
  }
  .dark {
    --background: 222.2 84% 4.9%;
    --foreground: 210 40% 98%;
    --card: 222.2 84% 4.9%;
    --card-foreground: 210 40% 98%;
    --popover: 222.2 84% 4.9%;
    --popover-foreground: 210 40% 98%;
    --primary: 210 40% 98%;
    --primary-foreground: 222.2 47.4% 11.2%;
    --secondary: 217.2 32.6% 17.5%;
    --secondary-foreground: 210 40% 98%;
    --muted: 217.2 32.6% 17.5%;
    --muted-foreground: 215 20.2% 65.1%;
    --accent: 217.2 32.6% 17.5%;
    --accent-foreground: 210 40% 98%;
    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 210 40% 98%;
    --border: 217.2 32.6% 17.5%;
    --input: 217.2 32.6% 17.5%;
    --ring: 212.7 26.8% 83.9%;
    --chart-1: 220 70% 50%;
    --chart-2: 160 60% 45%;
    --chart-3: 30 80% 55%;
    --chart-4: 280 65% 60%;
    --chart-5: 340 75% 55%;
  }
}

/* Catppuccin scope for Admin AI */
@layer base {
  .theme-catppuccin {
    /* Shared chat column width for Admin AI */
    --chat-col-width: 65ch;
    /* Accent (Lavender, Latte, softened to a light tint) */
    --accent: 230.9 97.2% 92%;
    --accent-foreground: 233.8 16% 35.5%;
    /* Text tokens (Latte) */
    --foreground: 233.8 16% 35.5%; /* #4c4f69 */
    --muted-foreground: 232.8 10.4% 47.3%; /* #6c6f85 */
    /* Status tokens (Catppuccin Latte) */
    --geist-success: #40a02b; /* green */
    --geist-error: #d20f39; /* red */
    --geist-warning: #df8e1d; /* yellow */

    /* Catppuccin Latte palette (subset) */
    --ctp-lavender: #7287fd;
    --ctp-mauve: #8839ef;
    --ctp-blue: #1e66f5;
    --ctp-green: #40a02b;
    --ctp-yellow: #df8e1d;
    --ctp-red: #d20f39;
    --ctp-peach: #fe640b;
  }
}

/* Dark-mode override for Catppuccin (Mocha text) */
@layer base {
  .dark .theme-catppuccin {
    /* Text tokens (Mocha) */
    --foreground: 226.2 63.9% 88%; /* #cdd6f4 */
    --muted-foreground: 227.6 23.6% 71.8%; /* #a6adc8 */
    /* Ensure accent labels remain legible on dark */
    --accent-foreground: 226.2 63.9% 88%;

    /* Catppuccin Mocha palette (subset) */
    --ctp-lavender: #b4befe;
    --ctp-mauve: #cba6f7;
    --ctp-blue: #89b4fa;
    --ctp-green: #a6e3a1;
    --ctp-yellow: #f9e2af;
    --ctp-red: #f38ba8;
    --ctp-peach: #fab387;
  }
}

/* Tailwind v4 theme tokens mapped to existing CSS vars */
@theme {
  /* Colors */
  --color-border: hsl(var(--border));
  --color-input: hsl(var(--input));
  --color-ring: hsl(var(--ring));
  --color-background: hsl(var(--background));
  --color-foreground: hsl(var(--foreground));

  --color-primary: hsl(var(--primary));
  --color-primary-foreground: hsl(var(--primary-foreground));
  --color-secondary: hsl(var(--secondary));
  --color-secondary-foreground: hsl(var(--secondary-foreground));
  --color-destructive: hsl(var(--destructive));
  --color-destructive-foreground: hsl(var(--destructive-foreground));
  --color-muted: hsl(var(--muted));
  --color-muted-foreground: hsl(var(--muted-foreground));
  --color-accent: hsl(var(--accent));
  --color-accent-foreground: hsl(var(--accent-foreground));
  --color-popover: hsl(var(--popover));
  --color-popover-foreground: hsl(var(--popover-foreground));
  --color-card: hsl(var(--card));
  --color-card-foreground: hsl(var(--card-foreground));

  /* Additional tokens for UI switch */
  --color-gray-100: var(--ds-gray-100);
  --color-gray-800: var(--ds-gray-800);
  --color-gray-900: var(--ds-gray-900);
  --color-gray-1000: var(--ds-gray-1000);
  --color-gray-alpha-400: var(--ds-gray-alpha-400);
  --color-background-100: var(--ds-background-100);

  --color-success: var(--geist-success);
  --color-error: var(--geist-error);
  --color-warning: var(--geist-warning);
  --color-violet: var(--geist-violet);
  --color-geist-foreground: var(--geist-foreground);

  /* Fonts */
  --font-sans: var(--font-archivo), var(--font-mashanzheng);
  --font-serif: var(--font-archivo), var(--font-mashanzheng);

  /* Radii (for rounded-*) */
  --radius-lg: var(--radius);
  --radius-md: calc(var(--radius) - 2px);
  --radius-sm: calc(var(--radius) - 4px);
}

@layer base {
  * {
    /* Tailwind v4: replace @apply border-border with direct CSS */
    border-color: hsl(var(--border));
  }
  body {
    /* Tailwind v4: replace @apply bg-background text-foreground */
    background-color: hsl(var(--background));
    color: hsl(var(--foreground));
  }
  /* Ensure form controls inherit the same font stack for mixed input */
  input,
  textarea,
  select,
  button {
    font: inherit;
  }

  /*
    Chinese rendering and weight notes
    - We use Archivo for Latin and Ma Shan Zheng for Chinese.
    - Some browsers may fallback away from Ma Shan Zheng when a bold weight
      (700/800) is requested because the font ships only a 400 weight.
    - To keep Chinese text in Ma Shan Zheng reliably, we prefer the same stack
      and explicitly cap heading weight for zh content to 400.
  */
  /* Use per-glyph fallback instead of forcing zh pages to Chinese-first */
  :lang(zh) h1,
  :lang(zh) h2,
  :lang(zh) h3 {
    /* Force a weight Ma Shan Zheng supports to prevent family fallback */
    font-weight: 400 !important;
    font-synthesis-weight: none;
  }

  /* Normalize common UI weights on zh pages so MaShanZheng (400 only) stays applied */
  :lang(zh) :where(a, button, label, nav, .font-medium, .font-semibold) {
    font-weight: 400 !important;
    font-synthesis-weight: none;
  }
}

/* Self-hosted Chinese font with unicode-range so it only loads when needed */
@font-face {
  font-family: 'MaShanZhengZh';
  src:
    url('/fonts/ma-shan-zheng/MaShanZheng-Regular.woff2') format('woff2'),
    url('/fonts/ma-shan-zheng/MaShanZheng-Regular.ttf') format('truetype');
  font-weight: 400;
  font-style: normal;
  font-display: swap;
  size-adjust: 118%;
  /* Core CJK ranges + fullwidth forms */
  unicode-range: U+3000-303F, U+3400-4DBF, U+4E00-9FFF, U+FF00-FFEF;
}

@layer utilities {
  /* Catppuccin color utilities (light/dark resolve via variables) */
  .text-ctp-lavender {
    color: var(--ctp-lavender);
  }
  .text-ctp-mauve {
    color: var(--ctp-mauve);
  }
  .text-ctp-blue {
    color: var(--ctp-blue);
  }
  .text-ctp-green {
    color: var(--ctp-green);
  }
  .text-ctp-yellow {
    color: var(--ctp-yellow);
  }
  .text-ctp-red {
    color: var(--ctp-red);
  }
  .text-ctp-peach {
    color: var(--ctp-peach);
  }
  .animate-delay-0 {
    animation-delay: 0ms;
  }
  .animate-delay-4000 {
    animation-delay: 4000ms;
  }
}

/* Custom animations used in app */
@keyframes blink {
  0%,
  100% {
    opacity: 1;
  }
  50% {
    opacity: 0;
  }
}
@utility animate-blink {
  animation: blink 1s ease-in-out infinite;
}

@keyframes spin-slow {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}
@utility animate-spin-slow {
  animation: spin-slow 10s linear infinite;
}

/* Base variables for additional tokens */
@layer base {
  :root {
    --ds-gray-100: hsla(0, 0%, 95%, 1);
    --ds-gray-800: hsla(0, 0%, 49%, 1);
    --ds-gray-900: hsla(0, 0%, 40%, 1);
    --ds-gray-1000: hsla(0, 0%, 9%, 1);
    --ds-gray-alpha-400: hsla(0, 0%, 0%, 0.08);
    --ds-background-100: hsla(0, 0%, 100%, 1);

    --geist-success: #0070f3;
    --geist-error: #ee0000;
    --geist-warning: #f5a623;
    --geist-violet: #7928ca;
    --geist-foreground: #000;
  }

  .dark {
    --ds-gray-100: hsla(0, 0%, 10%, 1);
    --ds-gray-800: hsla(0, 0%, 49%, 1);
    --ds-gray-900: hsla(0, 0%, 63%, 1);
    --ds-gray-1000: hsla(0, 0%, 93%, 1);
    --ds-gray-alpha-400: hsla(0, 0%, 100%, 0.14);
    --ds-background-100: hsla(0, 0%, 4%, 1);

    --geist-error: #ff0000;
    --geist-foreground: #fff;
  }
}
